**Trading Bot**

- **Description:** A Python-based trading bot that collects market data from Alpaca, evaluates a low-risk swing strategy, executes orders via Alpaca, and logs activity and alerts to Discord. The project supports both local development and containerized deployment with PostgreSQL.

**Status:** Prototype / actively developed — uses Alpaca paper trading by default.

**Features**
- Market data collection (Alpaca)
- Low-risk swing strategy (SMA, RSI, MACD, ATR)
- Backtester scaffold
- Order execution with risk management and DB recording
- Discord notifications for signals, trades, and errors
- Docker + docker-compose for easy deployment with a Postgres DB

**Repository Structure**
- `main.py` — entry point (initializes DB and starts the bot)
- `bots/` — `runner.py`, `backtester.py` (runtime bot & backtest harness)
- `trading/` — `alpaca_client.py`, `order_executor.py` (broker wrappers and execution)
- `data/` — `collectors/` (Alpaca data collectors), `storage/` (DB connection and models)
- `strategy/` — indicator implementations and `low_risk_swing.py` strategy
- `notifications/` — `discord_logger.py` (Discord webhook logger)
- `config/` — `settings.py` (loads `local.env` and exposes `settings`)
- `dockerfile`, `docker-compose.yaml`, `.dockerignore`
- `requirements.txt` — Python dependencies
- `tests/` — tests and test scripts

**Environment Variables**
The project loads environment variables from `local.env` by default. Key variables:

- `ALPACA_API_KEY` — Alpaca API key
- `ALPACA_SECRET_KEY` — Alpaca secret key
- `ALPACA_BASE_URL` — Alpaca base URL (paper/live)
- `ALPACA_PAPER` — true/false (use paper trading)
- `DATABASE_URL` — SQLAlchemy/Postgres connection string
- `DISCORD_WEBHOOK_TRADES` — webhook for trade notifications
- `DISCORD_WEBHOOK_ALERTS` — webhook for system alerts/errors
- `DISCORD_WEBHOOK_DEBUG` — webhook for debug logs

Do NOT commit real secrets to the repo. `.dockerignore` already excludes `local.env`.

**Quickstart — Local (non-container)**
1. Create a virtual environment and install dependencies:

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

2. Create `local.env` (copy from `local.env` example or set required vars).

3. Initialize the database and run the bot:

```bash
python main.py
```

The `main.py` script calls `init_db()` and starts the `TradingBot` runner which loops, fetching data, running the strategy, and executing orders.

**Quickstart — Docker (recommended for consistent environment)**
1. Ensure `local.env` is present in the project root (it is referenced from `docker-compose.yaml`).
2. Build and start with docker-compose:

```bash
docker-compose up -d --build
```

Notes:
- `docker-compose.yaml` sets `env_file: local.env` so variables are injected at runtime.
- The Compose file overrides `DATABASE_URL` to use the `db` service hostname so Postgres is reachable from the container.
- `.dockerignore` prevents `local.env` and similar files from being included in the image when `COPY . .` runs.

**Running Backtests**
- A simple backtest scaffold is available at `bots/backtester.py`. It uses data from `data.collectors.alpaca_collector` and runs the strategy over historical bars. This is a starting point — extend it to produce PnL metrics.

**Database**
- SQLAlchemy models live under `data/storage/models.py` and include `PriceData`, `Trade`, and `Signal`.
- `data/storage/database.py` exposes `init_db()` and `SessionLocal` for DB interactions.

**Testing**
- There is a `tests/` directory and a `tests/test.sh` script. You can also run unit tests with `pytest` if tests are provided.

**Security & Best Practices**
- Never commit `local.env` or real secrets to version control. Use environment-specific secret management in production (Docker secrets, cloud secret stores, CI/CD secrets).
- Rotate API keys regularly and use paper trading while testing.
- Limit network access and run the bot on a secure host when connected to live accounts.

**Troubleshooting**
- If the bot cannot reach Postgres in Docker, verify `docker-compose` is running and `DATABASE_URL` is set to `postgresql://postgres:password@db:5432/tradingbot` (compose overrides this automatically).
- If Alpaca API calls fail, verify `ALPACA_API_KEY`, `ALPACA_SECRET_KEY`, and `ALPACA_BASE_URL` are correct and that your account supports the queried endpoints.

**Next recommended repo improvements**
- Add `local.env.example` with placeholder values (I can add this for you).
- Add `.gitignore` entries for environment files (I can add this too).
- Add CI integration for running tests and securely injecting secrets.
- Improve backtester reporting (equity curve, metrics, trade logs).

If you'd like, I can also add a `local.env.example` and a `.gitignore` now, and optionally open a small PR with those files.

---
Generated by an automated README draft. Update sections to reflect final choices before publishing.
